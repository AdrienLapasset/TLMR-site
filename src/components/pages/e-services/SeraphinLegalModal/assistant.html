<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.min.js"></script>
<style>
  :root {
    --theme-color: #8e0808;

    --theme-color-light: #8e080833;
  }

  #API-container #assistantHeader {
    background-image: linear-gradient(97deg, #8e0808, #8e0808);
  }

  #API-container .mainColor {
    color: var(--theme-color) !important;

    border-color: var(--theme-color);
  }

  #API-container .colorButton,
  .colorButton:active,
  .colorButton:hover {
    color: var(--theme-color);
  }

  #API-container .headBand {
    background-color: #f4f1c3;
  }

  #API-container .file-input {
    color: white;

    background-color: var(--theme-color);

    padding: 10px;

    border-radius: 20px;
  }

  #API-container .buttonAnswer {
    color: var(--theme-color) !important;

    border-color: var(--theme-color) !important;
  }

  #API-container .buttonAnswer:focus {
    outline: none !important;
  }

  #API-container .buttonAnswer.reversed,
  #API-container
    .buttonAnswer.reversed:hover
    #API-container
    .buttonAnswer.reversed:focus {
    color: white !important;

    background-color: var(--theme-color) !important;
  }

  #API-container .buttonAnswer:hover:not(.reversed),
  #API-container .buttonAnswer.selected:not(.reversed) {
    background-color: var(--theme-color-light) !important;
  }

  #API-container .nextButton {
    background-color: var(--theme-color) !important;

    border-color: var(--theme-color) !important;
  }

  #API-container .nextButton:hover {
    background-color: var(--theme-color-light) !important;

    color: var(--theme-color) !important;
  }

  #API-container .form-content {
    display: table;

    width: 95%;
  }

  #API-container #history-tree > h3,
  #API-container #history-tree .assistant-tree-circle,
  #API-container #history-tree .answer-content {
    color: var(--theme-color) !important;
  }

  #API-container #history-tree .history-border {
    border-left: 3px solid var(--theme-color) !important;
  }

  #API-container
    .assistant-card.chat-layout
    .assistant-card-content
    .message.answer {
    color: var(--theme-color) !important;

    background-color: var(--theme-color-light) !important;
  }

  #API-container
    .assistant-card.chat-layout
    .assistant-card-content
    .message.question {
    background-color: var(--theme-color) !important;
  }

  /* Do not group with other classes because of Edge compatibility */

  #API-container
    .assistant-card.chat-layout
    .assistant-card-content::-webkit-scrollbar-thumb {
    background-color: var(--theme-color) !important;
  }

  #API-container .assistant-card a,
  #API-container .assistant-card a:hover,
  #API-container .assistant-card a:focus {
    text-decoration: underline;

    font-weight: 700;
  }

  #API-container .assistant-card a:not(.reversed),
  #API-container .assistant-card a:hover:not(.reversed),
  #API-container .assistant-card a:focus:not(.reversed) {
    color: var(--theme-color) !important;
  }

  #API-container .assistant-card.chat-layout a:not(.buttonAnswer),
  #API-container .assistant-card.chat-layout a:hover:not(.buttonAnswer),
  #API-container .assistant-card.chat-layout a:focus:not(.buttonAnswer) {
    color: white !important;
  }

  #API-container input[type="email"],
  #API-container input[type="file"],
  #API-container input[type="number"],
  #API-container input[type="password"],
  #API-container input[type="text"],
  #API-container textarea,
  #API-container select {
    border: 1px solid var(--theme-color) !important;

    border-radius: 3px;

    background-color: #fff;

    box-shadow: 0 2px 21px 0 rgba(0, 0, 0, 0.12);

    text-align: left;
  }

  #API-container input[type="email"],
  #API-container input[type="file"],
  #API-container input[type="number"],
  #API-container input[type="password"],
  #API-container input[type="text"],
  #API-container textarea {
    padding: 14px 20px;

    width: 100%;
  }

  #API-container select.picker__select--month,
  #API-container select.picker__select--year {
    height: 40px;
  }

  #API-container .buttonAnswer.edit-btn {
    padding-right: 2.5em;
  }

  #API-container .buttonAnswer p {
    margin: 0;
  }

  #API-container .test-viewer-edit {
    position: absolute;

    top: 20%;

    right: -1em;

    border: none;

    outline: none;

    background: transparent;

    box-shadow: none;
  }

  #API-container .test-viewer-edit i.far {
    color: var(--theme-color) !important;

    font-size: 1.5em !important;
  }

  #API-container .fr-element.fr-view {
    min-height: unset !important;
  }
</style>

<div id="API-container">
  <p class="text-center h2" data-bind="visible:false">
    Chargement de votre assistant
  </p>

  <div class="divid" data-bind="visible:false">
    <div class="fol">
      <div class="fol dol"></div>
    </div>
  </div>

  <div
    class="assistant-card"
    style="display: none"
    data-bind="with:currentQuestion, visible:true"
  >
    <div
      class="assistant-card-header"
      id="assistantHeader"
      onclick="updateDisplay(this)"
    >
      <!-- ko if: ko.unwrap($root.AvatarUrl) -->

      <img
        class="assistant-avatar"
        data-bind="src: ko.unwrap($root.AvatarUrl)"
      />

      <!-- /ko -->

      <!-- ko ifnot: ko.unwrap($root.AvatarUrl) -->

      <img
        src="https://assistantapi.blob.core.windows.net/avatars/avatar.png"
        class="assistant-avatar"
      />

      <!-- /ko -->

      <p id="assistantHeader-text"></p>

      <i
        class="fas fa-list-ul fa-2x visible-md-block hidden-xs hidden-sm head-right-content"
        id="btn-history-list"
        onclick="toggleAssistantHistory()"
      ></i>
    </div>

    <div
      class="col-sm-offset-1 col-md-offset-2 assistant-card-content"
      style="padding-bottom: 20px; margin-top: 25px"
      data-bind="visible:!$root.endText()"
    >
      <p
        class="endText"
        data-bind="text:$root.endText, visible:$root.endText()"
      ></p>

      <h3
        class="question-title"
        data-bind="html: $data.HtmlText() || $data.Text()"
      ></h3>

      <!-- ko if:$root.forms().length > 0-->

      <div class="form-content">
        <!-- ko foreach:$root.forms -->

        <!-- ko if:type() < 4 || type() === 8 -->

        <div class="form-group">
          <label
            class="assistant-label"
            data-bind="attr:{ 'for' : 'input_'+$index()}, html:$data.name()"
          ></label>

          <span class="warning-text" data-bind="visible: Mandatory() === true"
            >*</span
          >

          <input
            class="form-control assistant-input no-padding-bottom-top"
            data-bind="attr:{id : 'input_'+$index(), 'type' : $data.type() === 1 || $data.type() === 8 ? 'text' : ($data.type() === 2 ? 'email' : 'number')}, value: FormValue, css: { datepicker: $data.type() === 8 }"
          />

          <p class="fieldError warning-text"></p>
        </div>

        <!-- /ko -->

        <!-- ko if:type() == 4-->

        <div class="" style="margin-bottom: 15px">
          <label
            class="assistant-label"
            data-bind="attr:{ 'for' : 'input_'+$index()}, html:$data.name()"
          ></label>

          <span class="warning-text" data-bind="visible: Mandatory() === true"
            >*</span
          >

          <textarea
            class="form-control no-padding-bottom-top assistant-textarea"
            data-bind="attr:{id : 'input_'+$index()}, textInput: FormValue, autoResize: FormValue"
            rows="4"
            style="resize: vertical; width: 85%"
          ></textarea>

          <p class="fieldError warning-text"></p>
        </div>

        <!-- /ko -->

        <!-- ko if:type() == 7-->

        <div class="" style="z-index: 1">
          <label class="assistant-label" data-bind="html: name()"></label>

          <span class="warning-text" data-bind="visible: Mandatory() === true"
            >*</span
          >

          <div data-bind="attr:{ id: 'upload_' + $index()}">
            <input
              type="button"
              class="form-control"
              value="Choisir le(s) fichier(s) &#224; transmettre"
              data-bind="click:$root.upload"
            />

            <input
              type="file"
              class="hidden"
              data-bind="attr: { id: 'file-input_' + $index(), 'data-idx':$index(), 'data-qid' : $root.currentQuestion().Key() }, dmUploader : $data"
              data-placement="left"
            />

            <label></label>

            <p class="fieldError warning-text"></p>
          </div>
        </div>

        <!-- /ko -->

        <!-- /ko -->
      </div>

      <!-- /ko -->

      <!-- ko if:$root.forms().length == 0-->

      <!-- ko if:$data.Qcm() -->

      <div data-bind="foreach: $root.responses" class="text-center">
        <div class="myTooltip">
          <input
            type="checkbox"
            class="hidden"
            data-bind="value: Value, id: 'data_' + Key()"
          />

          <div style="position: relative; display: table">
            <button
              class="btn space-up-sm buttonAnswer"
              data-placement="left"
              data-bind="html: HtmlText() || Text(), click: $root.qcm, attr:{'data-idx' :  Key}, css : { 'selected' : Value }"
            ></button>

            <img
              src="https://assistant.api.seraphin.legal/images/iconcheck.svg"
              style="position: absolute; top: 5px; right: -9px; display: none"
              data-bind=" id: 'data_selected_' + Key, visible : Value"
            />
          </div>

          <!-- ko if: $data.Comment -->

          <span class="myTooltipText" data-bind="html: Comment"></span>

          <!-- /ko -->
        </div>
      </div>

      <!-- /ko -->

      <!-- ko ifnot:$data.Qcm() -->

      <div data-bind="foreach:$root.responses" class="text-center">
        <div class="myTooltip">
          <button
            class="btn space-up-sm buttonAnswer"
            data-placement="left"
            data-bind="click: function(data, event){$root.showSub($data, $parent, event)}, html: HtmlText() || Text()"
          ></button>

          <!-- ko if: $data.Comment -->

          <span class="myTooltipText" data-bind="html: Comment"></span>

          <!-- /ko -->
        </div>
      </div>

      <!-- /ko -->

      <!-- /ko -->

      <!-- ko if: $root.haveDocumentsToDownload() || ($root.responses().length === 0 && $root.forms().length === 0 && $root.displayRecapDownload()) -->

      <div class="text-center flex">
        <!-- ko if: $root.haveDocumentsToDownload() -->

        <a
          class="btn space-up-sm buttonAnswer dl-btn reversed no-decoration reduce-on-hover"
          target="_blank"
          href=""
          data-bind="attr: { href: 'https://assistant.api.seraphin.legal/api/v2/Assistant/DownloadDocuments/4a1165e0-da40-41e6-80df-2ddee12e067c/' + $root.currentQuestion().Key() + '?lang=fr' }"
          download
          ><i class="fas fa-paperclip"></i>&nbsp;&nbsp;T&#233;l&#233;charger
          le(s) document(s)</a
        >

        <!-- /ko -->

        <!-- ko if: $root.displayRecapDownload() -->

        <a
          class="btn space-up-sm buttonAnswer dl-btn reversed no-decoration reduce-on-hover"
          target="_blank"
          href="https://assistant.api.seraphin.legal/api/v2/Assistant/DownloadDocuments/4a1165e0-da40-41e6-80df-2ddee12e067c?lang=fr"
          download
          ><i class="fas fa-list"></i>&nbsp;&nbsp;T&#233;l&#233;charger mes
          r&#233;ponses</a
        >

        <!-- /ko -->
      </div>

      <!-- /ko -->
    </div>

    <div class="container-fluid">
      <!-- ko if: $data.Qcm() && $root.responses().length > 0 -->

      <div class="nextDiv">
        <input
          type="button"
          class="btn space-up-l side-margin text-uppercase nextButton"
          data-bind="click: function(data, event){$root.showSub($root.responses()[0], event, true)}, enable: $root.selectedOptions().length != 0"
          value="Suivant"
        />
      </div>

      <!-- /ko -->

      <!-- ko ifnot: $data.Qcm() -->

      <!-- ko if: ($root.forms().length > 0) -->

      <div class="nextDiv">
        <input
          type="button"
          class="btn space-up-l side-margin text-uppercase nextButton"
          data-bind="click: function(data, event){$root.showSub($root.responses()[0], event)}, attr: { value: $root.responses()[0] ? htmlDecode($root.responses()[0].Text()) : 'Suivant' }"
          value="Suivant"
        />
      </div>

      <!-- /ko -->

      <!-- /ko -->

      <div class="previous">
        <div
          class="space-up-l space-left-xl space-down side-margin clickable mainColor"
          data-bind="visible:$root.questionsHistoric().length > 1"
        >
          <i class="fas fa-arrow-circle-left" style="font-size: 18px"></i>

          <a
            class="bold no-decoration colorButton"
            data-bind="click:$root.previous"
            ><span
              class="text-uppercase"
              style="
                position: relative;
                left: 2px;
                font-size: 13px;
                bottom: 3px;
              "
              >Question pr&#233;c&#233;dente</span
            ></a
          >
        </div>
      </div>
    </div>

    <div class="clearfix"></div>

    <!-- ko if: $data.Comment -->

    <div class="container-fluid assistant-card-footer headBand">
      <img
        src="https://assistant.api.seraphin.legal/Images/Question.svg"
        class="visible-md-block hidden-xs hidden-sm"
      />

      <div class="assistant-card-footer-content headBand">
        <h3 style="margin-top: 0">Besoin d&#39;aide ?</h3>

        <span class="commentaire" data-bind="html: Comment"></span>
      </div>
    </div>

    <!-- /ko -->
  </div>

  <div id="history-tree" class="visible-md-block hidden-xs hidden-sm no-active">
    <h3 style="margin-bottom: 20px">Vos r&#233;ponses</h3>

    <div class="history-border">
      <!-- ko if: questionsHistoric().length === 1 -->

      <div class="single-question-block">
        <p
          class="assistant-tree-question"
          data-bind="html:currentQuestion().Text()"
        ></p>
      </div>

      <!-- /ko -->

      <!-- ko if: questionsHistoric().length !== 1 -->

      <div data-bind="foreach:questionsHistoric">
        <div class="qa-block">
          <p
            class="assistant-tree-question"
            data-bind="html:Question.Text()"
          ></p>

          <p
            class="assistant-tree-answer"
            data-bind="if:($index() !== $root.questionsHistoric().length - 1), click: function(data, event){$root.previousHistoric(data, event, $index())}"
          >
            <i class="fas fa-circle assistant-tree-circle"></i
            ><span
              class="answer-content"
              data-bind="html: $root.getAnswerHistory($root.selectedOptionsHistory()[$index()](), Responses, Forms)"
            ></span>
          </p>
        </div>
      </div>

      <!-- /ko -->
    </div>
  </div>
</div>

<script type="text/javascript">
  var domain = "https://assistant.api.seraphin.legal";

  var assistantModel = {
    UniqueCode: "4a1165e0-da40-41e6-80df-2ddee12e067c",
    ExternalCode: "b41c8e76-dace-4c7e-aa5a-1c8f4a906cb3",
    Theme: {
      Id: 1241,
      ExternalCode: "37df2c0b-a144-4dbb-ae22-a758e19de55e",
      Name: "block chaine",
      Color: "8E0808",
      HeadingStart: "8E0808",
      HeadingEnd: "8E0808",
      HeadBandColor: "F4F1C3",
      AvatarUrl:
        "https://assistantapi.blob.core.windows.net/avatars/avatar.png",
      AvatarDisplay: true,
      PreviousQuestion: true,
      Completion: false,
      HeadBandDisplay: true,
      IsDefault: true,
      PreviewUrl:
        "https://assistantapi.blob.core.windows.net/theme/theme/o353e7fdc9173463898007a340a78a8af/o1241/screenCapture.jpeg",
      Layout: null,
      ContinueLaterDisplay: false,
      IsBaseTheme: null,
      ThemeUsers: [],
    },
    Question: {
      Question: {
        Key: 1,
        Comment:
          "Il suffit tout simplement de répondre aux  questions proposées(13 à 15) et notre assistant virtuel générera le document en PDF.\n",
        QuestionType: 0,
        Text: '<strong style="font-weight: bold;">Bonjour !</strong></p>\n\n<p><strong style="font-weight: bold;">Bienvenue dans notre générateur de conditions générales d\'utilisation (CGU) sur mesure !</strong>',
        HtmlText:
          '<strong style="font-weight: bold;">Bonjour !</strong></p>\n\n<p><strong style="font-weight: bold;">Bienvenue dans notre générateur de conditions générales d\'utilisation (CGU) sur mesure !</strong>',
        Qcm: false,
        Category: null,
        EndQuestionText:
          "Merci d'avoir pris le temps de répondre à ces questions.",
        GroupKey: null,
        BlockUid: null,
      },
      Forms: [],
      Responses: [
        {
          Key: 2,
          Comment: "",
          Text: "C'est parti !",
          HtmlText: "C'est parti !",
          Value: false,
          LinkedKey: 0,
          IsDefaultAnswer: false,
          DisplayOrder: 1,
          BlockUid: null,
          GroupKey: null,
        },
      ],
      DisplayDownloadDocsButton: false,
      DisplayDownloadRecapButton: false,
    },
    SendEndCode: null,
    Lang: "fr",
    SaveResult: true,
    CanDownloadDocument: true,
    Testing: false,
    SaveStep: false,
    Results: null,
    History: null,
    AddEditButton: false,
  };

  var assistantTextResources = {
    Form: "Fomulaire",
    InvalidEmail: "Adresse e-mail invalide",
    FieldMandatory: "Ce champ est obligatoire",
    ErrorOccured: "Une erreur est survenue.",
  };

  function run(nodeToBind, addScript = true) {
    if (addScript) {
      const koScripts = [
        "https://assistant.api.seraphin.legal/Scripts/knockout-3.4.2.js",

        "https://assistant.api.seraphin.legal/Scripts/knockout.mapping-latest.js",

        "https://assistant.api.seraphin.legal/Scripts/knockout.extensions.js?3.4.1",
      ];

      const scripts = [
        "https://assistant.api.seraphin.legal/Scripts/dmuploader.js",

        "https://assistant.api.seraphin.legal/Scripts/bootstrap.modal.js",

        "https://assistant.api.seraphin.legal/Scripts/alertify.min.js",

        "https://assistant.api.seraphin.legal/Scripts/Tools/Tooltip.js?3.4.1",

        "https://assistant.api.seraphin.legal/Scripts/pickadate/compressed/legacy.js",

        "https://assistant.api.seraphin.legal/Scripts/pickadate/compressed/picker.js",

        "https://assistant.api.seraphin.legal/Scripts/pickadate/compressed/picker.date.js",

        "https://assistant.api.seraphin.legal/Scripts/pickadate/compressed/picker.time.js",

        "https://assistant.api.seraphin.legal/Scripts/pickadate/translations/fr_FR.js",

        "https://assistant.api.seraphin.legal/Scripts/Tools/tools.js?3.4.1",

        "https://assistant.api.seraphin.legal/Scripts/viewModels/externalAPIViewModel.v2.js?3.4.1",
      ];

      const bootstrap_enabled = typeof jQuery().modal == "function";

      if (bootstrap_enabled === true) {
        scripts.splice(
          scripts.indexOf(
            "https://assistant.api.seraphin.legal/Scripts/bootstrap.modal.js"
          ),
          1
        ); // remove script
      }

      async function load_scripts(script_urls_array) {
        function load(src) {
          return new Promise(function (resolve, reject) {
            var script = document.createElement("script");

            script.onload = resolve;

            script.src = src;

            script.async = false;

            if (
              src.indexOf("pickadate/") === -1 ||
              src.indexOf("translations/") !== -1 ||
              !document.querySelector(`script[src="${src}"]`)
            ) {
              // load pickadate scripts once

              console.log(script.src);

              document.head.appendChild(script);
            }
          });
        }

        var promises = [];

        for (const script_urls of script_urls_array) {
          promises.push(load(script_urls));
        }

        await Promise.all(promises);
      }

      if (typeof ko === "undefined") {
        // load knockout scripts

        load_scripts(koScripts).then(function () {
          // load other scripts after knockout

          load_scripts(scripts).then(function () {
            alertify.set("notifier", "position", "top-right");

            loadSAViewer(nodeToBind);

            if (typeof sa_cbk === "function") {
              sa_cbk();
            }
          });
        });
      } else {
        // load other scripts without knockout

        load_scripts(scripts).then(function () {
          alertify.set("notifier", "position", "top-right");

          loadSAViewer(nodeToBind);

          if (typeof sa_cbk === "function") {
            sa_cbk();
          }
        });
      }
    } else {
      loadSAViewer(nodeToBind);
    }
  }

  function toggleAssistantHistory() {
    var element = document.getElementById("history-tree");

    element.classList.toggle("no-active");
  }

  function updateDisplay(input) {
    if (input.parentNode.className.includes("float-layout")) {
      input.parentNode.classList.toggle("collapsed");
    }
  }
</script>

<link href="https://fonts.googleapis.com/css?family=Muli" rel="stylesheet" />

<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" />

<link
  rel="stylesheet"
  href="https://use.fontawesome.com/releases/v5.4.2/css/all.css"
  integrity="sha384-/rXc/GQVaYpyDdyxK+ecHPVYJSN9bmVFBvjA/9eOB+pb3F2w2N6fc5qB9Ew5yIns"
  crossorigin="anonymous"
/>

<link
  href="https://assistant.api.seraphin.legal/Content/assistant-ext-v2.css?3.4.1"
  rel="stylesheet"
  type="text/css"
/>

<link
  href="https://assistant.api.seraphin.legal/Content/tools.css?3.4.1"
  rel="stylesheet"
  type="text/css"
/>

<link
  href="https://assistant.api.seraphin.legal/Content/pickadate/default.css"
  rel="stylesheet"
  type="text/css"
/>

<link
  href="https://assistant.api.seraphin.legal/Content/pickadate/default.date.css"
  rel="stylesheet"
  type="text/css"
/>

<link
  href="https://assistant.api.seraphin.legal/Content/alertifyjs/alertify.min.css"
  rel="stylesheet"
/>

<link
  href="https://assistant.api.seraphin.legal/Content/alertifyjs/themes/bootstrap.min.css"
  rel="stylesheet"
/>
<script type="text/javascript">
  run();
</script>
